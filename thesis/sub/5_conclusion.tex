%!TEX ROOT=main.tex

In the first part of this thesis, a generic microcontroller--based module with LoRa communication, Over--the--air update capability,  sensor interfaces, and solar powering was developed. In the second part, a wireless sensor node for use in soil moisture sensing applications, useful for managing water resources in agriculture, horticulture, and home environments, was realized.

The communications module is based on the STM32WLE5JC System on a Chip supporting the LoRa wireless interface operating in the EU868 band. The module was designed, manufactured, and validated. Its biggest differentiator against other similar hardware is the integrated 1 Mbyte non--volatile memory, which can be used for data logging and configuration, but its main purpose is to facilitate safe and efficient Over--the--air updates of the firmware running on the module. This module is versatile enough to be useful in other applications outside of this work with its small footprint of $20.32 \times 22.48~\mathrm{mm}$, low power consumption (9 mA receiving) and 16 Input/Output pins supporting interfaces such as UART, I2C and featuring 5 ADC channels.

For the firmware and host--side software implementation the Rust programming language was used. STM32 support and the async--await executor were provided by the Embassy project, together with the Bootloader, while the \code{lora-rs} library was used to integrate LoRa. The firmware was split into the 
\begin{itemize}
    \item generic \code{module-runtime} library code, which includes hardware initialization, the OTA implementation and other utilities,
    \item the \code{module-gateway} and \code{module-node} applications, which implement the Gateway (communication with the host computer) and the Node (moisture sensing application), respectively.
\end{itemize}

The soil moisture sensor is a piece of hardware containing the LoRa module, 4 capacitive sensing zones, 2 temperature sensors, measuring and charging circuitry, and is designed to be stuck into the soil to measure its moisture content. The active sensor area can measure the volumetric moisture level at 20, 50, 90, and 120 millimeters below the surface; the temperature is measured near the surface and at 150 millimeters below the surface. The sensor is able to charge its 330 mAh lithium cell from an integrated 150 mWp solar panel and stay operational throughout the day currently, however with more work it could function for weeks on a single charge, without much sunlight.

Range test was conducted in a typical deployment scenario, where the LoRa module proved to maintain a stable connection at a distance of over 1 kilometer, with its antenna positioned only 190 millimeters above ground level. This was achieved at 15 dBm transmit power with the spreading factor set to 11, yielding an average data rate of 300 bits per second (including protocol overhead and dead time). It is even possible to far exceed this range in more favorable conditions, or increase the transfer speed significantly (up to 9 times) at the expanse of some range.